---
title: "Final Project"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
# install.packages("mapcan")
# you will probably need to install this package is specific to choropleths for Canada
library(flexdashboard)
library(here)
library(readxl)
library(mapcan)
library(tidyverse)
library(janitor)
library(shiny)
library(plotly)
```

``` {r prep}
composition_data <- read_excel(here("data", "class_size_composition.xlsx")) %>% 
  filter(DATA_LEVEL == "DISTRICT LEVEL",
         GRADE_GROUP == "All Grades")

districting <- read_excel(here("data", "DataVizfinal_names.xlsx")) %>% 
  select(SD,
         DISTRICT_NAME,
         riding_name_english,
         Code) %>% 
  full_join(composition_data, by = "DISTRICT_NAME") %>% 
  rename(riding_code = Code)

```


Individualized Education Programs in BC
===============================

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r setMap}
BC_data <- mapcan::census_pop2016 %>% 
  select(population_2016,
         pr_english,
         population_density_2016,
         born_outside_canada,
         census_division_name) %>% 
  filter(pr_english == "British Columbia") %>% 
    mapcan(boundaries = ridings,
          type = standard,
          province = BC)

IEPex1 <- districting %>% 
   filter(SCHOOL_YEAR == "2019/2020") %>% 
  select(NUMBER_CLASSES_0_IEP,
         riding_code) %>% 
  group_by(riding_code) %>% 
  summarise(NUMBER_CLASSES_0_IEP = sum(NUMBER_CLASSES_0_IEP)) %>% 
  drop_na() %>% 
  full_join(BC_data, by = "riding_code")

IEP <- ggplot(IEPex1, aes(x = long, y = lat, group = group, fill = NUMBER_CLASSES_0_IEP)) +
  geom_polygon() +
  coord_fixed() +
  theme_mapcan()

# plotly::ggplotly(IEP)
renderPlotly(IEP)

```

English Learners in BC
=============================

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r ELexample}

ELex1 <- districting %>% 
   filter(SCHOOL_YEAR == "2019/2020") %>% 
  select(NUMBER_CLASSES_1_ELL,
         riding_code) %>% 
  group_by(riding_code) %>% 
  summarise(NUMBER_CLASSES_1_ELL = sum(NUMBER_CLASSES_1_ELL)) %>% 
  drop_na() %>% 
  full_join(BC_data, by = "riding_code")

EL <- ggplot(ELex1, aes(x = long, y = lat, group = group, fill = NUMBER_CLASSES_1_ELL)) +
  geom_polygon() +
  coord_fixed() +
  theme_mapcan()

renderPlotly(EL)
```

### Chart C

```{r}

```

